<!-- MarkdownTOC autolink="true" -->

- [作りたいもの](#%E4%BD%9C%E3%82%8A%E3%81%9F%E3%81%84%E3%82%82%E3%81%AE)
- [実装中](#%E5%AE%9F%E8%A3%85%E4%B8%AD)
- [GameObject.Find](#gameobjectfind)
- [Example Scene](#example-scene)
- [メッセージGUI](#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8gui)
    - [外観](#%E5%A4%96%E8%A6%B3)
    - [実装](#%E5%AE%9F%E8%A3%85)
- [蝶の動き](#%E8%9D%B6%E3%81%AE%E5%8B%95%E3%81%8D)
    - [移動の実装](#%E7%A7%BB%E5%8B%95%E3%81%AE%E5%AE%9F%E8%A3%85)
    - [ひらひらする動きの実装](#%E3%81%B2%E3%82%89%E3%81%B2%E3%82%89%E3%81%99%E3%82%8B%E5%8B%95%E3%81%8D%E3%81%AE%E5%AE%9F%E8%A3%85)
    - [Asset作り](#asset%E4%BD%9C%E3%82%8A)

<!-- /MarkdownTOC -->

# 作りたいもの
手に蝶が乗ってひらひらする  
https://twitter.com/SIitherinn/status/983708984812167168  
これをGW開けまでに作る.  

# 実装中
1. 蝶をクリックすると説明が出る.  
1. 蝶がひらひら動く.  

# GameObject.Find
Hierarchyから引数と同じ名前のオブジェクトを取得する.  

    例
    GameObject messagepanel;
    messagepanel = GameObject.Find( "ActiveMessagePanel" )
    とすると、messagepanelにActiveMessagePanelのオブジェクトが参照され格納される.

# Example Scene
Grass and Flower pack 1のシーン  
これにオブジェクトを設置して作っている  

# メッセージGUI

##外観  
![messageUI](figure/messageUI.png "messageUI")  
階層構造はこんなかんじ  
![messageUI](figure/messageUIarchitecture.png "messageUI architecture")  

パラメータ:  

    Panel
    stretch-stretch
    Left 10, Top 200, Pos Z 0
    Right 10, Bottom 10

    Text
    stretch-stretch
    Left 10, Top 10, Pos Z 10
    Right 10, Bottom 10

    Image
    stretch-stretch
    Left 400, Top 95, Pos Z 0
    Right 10, Bottom 10
参考: https://gametukurikata.com/program/rpgmessage  

## 実装
ActiveMessagePanel.cs

    using UnityEngine;
    using System.Collections;
    public class ActiveMessagePanel : MonoBehaviour {
        //　MessageUIに設定されているMessageスクリプトを設定
        [SerializeField]
        private Message messageScript;
        private GameObject refObj;
        public string cubeTag="Cube";
        Ray ray;
        RaycastHit hit = new RaycastHit();
        // Update is called once per frame
        void Update () {
            if (Input.GetMouseButtonDown(0))
            {
                ray = Camera.main.ScreenPointToRay(Input.mousePosition);
                //マウスクリックした場所からRayを飛ばし、オブジェクトがあればtrue 
                if (Physics.Raycast(ray.origin, ray.direction, out hit, Mathf.Infinity))
                {
                    if(hit.collider.gameObject.CompareTag(cubeTag))
                    {
                        // cubeControlクラスにmessageScriptオブジェクトを渡して，定められたメッセージを表示する.
                        hit.collider.gameObject.GetComponent<CubeControl>().OnUserAction(messageScript);
                    }
                }
            }
        }
    }

CubeControl.cs

    using UnityEngine;
    using System.Collections;
    [RequireComponent(typeof(Rigidbody))]
    public class CubeControl : MonoBehaviour {
        private string message = "テストメッセージ\n"
        + "ここに種ごとの説明が入る予定\n";
        public void OnUserAction(Message messageScript)
        {
            messageScript.SetMessagePanel(message);
        }
    }


# 蝶の動き
Control.csのUpdateで以下のように，変更すれば位置を変更できる．

    絶対位置
    this.transform.position += new Vector3(x, y, z);
    相対位置
    this.transform.localPosition += new Vector3(x, y, z);


Unityのランダムは以下のように用いる．

    float x = Random.Range(-0.1f, 0.1f);

向いている方向に移動する

    this.transform.rotation = Quaternion.Slerp(this.transform.rotation, Quaternion.LookRotation(new Vector3(x, y, z)), 0.1f);
    this.transform.localPosition += new Vector3(0, -0.3f, 0);

    Reference
    Quaternion.Slerp(quaternion rot1, quaternion rot2, float vel)
    Quaternion.LookRotation(quaternion rot)

## 移動の実装
1. グローバルな移動方向と，ローカルな移動方向を組み合わせる．  
1. ローカルな移動方向のみ  


## ひらひらする動きの実装
http://indie-du.com/entry/2016/05/15/090000  
メッシュモデル，関節などを設定したあと，unityでキーフレームを設定することで動きを作れるっぽい  https://techacademy.jp/magazine/9284  

Animationの作り方  
http://www.atmarkit.co.jp/ait/articles/1411/20/news045_2.html

## Asset作り
人形モデル  
メッシュモデルを作ってBlenderで関節を埋め込んで動かす.  
全体 http://takashicompany.hatenablog.com/entry/2013/11/10/215814
Blender使い方 http://nn-hokuson.hatenablog.com/entry/2017/10/03/205639  
Blenderハマりポイント https://twitter.com/HomeMasisi/status/633614935897968641  